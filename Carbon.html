<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>專業低碳管理方案流程圖及對應表格</title>
    <style>
        #flowchart {
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #f0f0f0;
            border: 1px solid #ddd;
            overflow-x: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        .node text {
            font: 14px sans-serif;
        }
        .link {
            fill: none;
            stroke: #666;
            stroke-width: 2px;
            marker-end: url(#arrow);
        }
        .arrowHead {
            fill: #666;
        }
        .highlight {
            background-color: #ffe4c4;
        }
        .link-text {
            font: 12px sans-serif;
            text-anchor: middle;
            fill: #333;
        }

        @media (max-width: 768px) {
            #flowchart svg {
                width: 100%;
                height: auto;
            }
            .link-text {
                font-size: 10px;
            }
            .node text {
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <h1>碳盤查</h1>
    <div id="flowchart">
        <svg viewBox="0 0 800 400" preserveAspectRatio="xMidYMid meet"></svg>
    </div>
    <table id="details">
        <thead>
            <tr>
                <th>項目</th>
                <th>內容</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const data = [
                {
                    id: "企業自主碳盤查",
                    desc: "A. 線上免費估算工具<img src='https://github.com/Sethjesus/Photo/blob/main/Carbon1.jpg?raw=true' alt='圖示' width='100'><img src='https://github.com/Sethjesus/Photo/blob/main/Carbon2.jpg?raw=true' alt='圖示' width='100'><br>B. AI探盤查管理平台<img src='https://github.com/Sethjesus/Photo/blob/main/Carbon3.jpg?raw=true' alt='圖示' width='100'><img src='https://github.com/Sethjesus/Photo/blob/main/Carbon4.jpg?raw=true' alt='圖示' width='100'><img src='https://github.com/Sethjesus/Photo/blob/main/Carbon5.jpg?raw=true' alt='圖示' width='100'><br>C. AI碳盤查管理平台<img src='https://github.com/Sethjesus/Photo/blob/main/Carbon6.jpg?raw=true' alt='圖示' width='100'><br>(以上方案均提供一套無線能耗足跡管理工具。<br>",
                    color: "#ff7f0e",
                    shape: "rect",
                    x: 100,
                    y: 100,
                    width: 150,
                    height: 70
                },
                {
                    id: "政府補助碳盤查(16+4)",
                    desc: "113年經濟部<br>製造業低碳化及智慧化升級轉型診斷輔導<br>(含政府款16萬元，廠商自籌款4萬元)<br><a href='https://assist.nat.gov.tw/wSite/ct?xItem=253909&ctNode=232&mp=2' target='_blank'>查看詳情</a><br>(可作為產發署低碳化補助申請計畫使用)<br><img src='https://example.com/path/to/your/image2.png' alt='圖示' width='100'>",
                    color: "#2ca02c",
                    shape: "rect",
                    x: 300,
                    y: 100,
                    width: 150,
                    height: 70
                },
                {
                    id: "諮詢輔導",
                    desc: "A.企業自主碳盤查諮詢輔導<br>B. 低碳化/減碳方案規劃建議 。<br><img src='https://example.com/path/to/your/image3.png' alt='圖示' width='100'>",
                    color: "#1f77b4",
                    shape: "rect",
                    x: 500,
                    y: 100,
                    width: 150,
                    height: 70
                },
                {
                    id: "免費可行性評估",
                    desc: "A. 企業低碳化可行性評估<br>產發署低碳化補助申請可行性評估<br><img src='https://example.com/path/to/your/image4.png' alt='圖示' width='100'>",
                    color: "#d62728",
                    shape: "rect",
                    x: 700,
                    y: 100,
                    width: 150,
                    height: 70
                }
            ];

            const svg = d3.select("#flowchart svg");

            svg.append("defs").append("marker")
                .attr("id", "arrow")
                .attr("viewBox", "0 -5 10 10")
                .attr("refX", 5)
                .attr("refY", 0)
                .attr("markerWidth", 6)
                .attr("markerHeight", 6)
                .attr("orient", "auto")
                .append("path")
                .attr("d", "M0,-5L10,0L0,5")
                .style("fill", "#666");

            const nodeGroup = svg.selectAll("g.node")
                .data(data)
                .enter()
                .append("g")
                .attr("class", "node")
                .attr("transform", d => `translate(${d.x}, ${d.y})`)
                .on("click", function(event, d) {
                    document.getElementById(d.id).scrollIntoView({behavior: 'smooth', block: 'center'});
                    highlightRow(d);
                });

            nodeGroup.each(function(d) {
                const node = d3.select(this);
                node.append("rect")
                    .attr("x", -d.width / 2)
                    .attr("y", -d.height / 2)
                    .attr("width", d.width)
                    .attr("height", d.height)
                    .style("fill", d.color);

                node.append("text")
                    .attr("y", 5)
                    .attr("text-anchor", "middle")
                    .text(d.id);
            });

            const linkElements = svg.selectAll(".link")
                .data(data.slice(1).map((d, i) => {
                    const source = data[i];
                    const target = d;

                    const sourceX = source.x + source.width / 2 + 10;
                    const sourceY = source.y;

                    const targetX = target.x - target.width / 2 - 10;
                    const targetY = target.y;

                    return {sourceX, sourceY, targetX, targetY};
                }))
                .enter()
                .append("g");

            linkElements.append("path")
                .attr("class", "link")
                .attr("d", d => `M${d.sourceX},${d.sourceY} L${d.targetX},${d.targetY}`)
                .attr("marker-end", "url(#arrow)");

            linkElements.each(function(d, i) {
                const midX = (d.sourceX + d.targetX) / 2;
                const midY = (d.sourceY + d.targetY) / 2;

                d3.select(this).append("text")
                    .attr("class", "link-text")
                    .attr("x", midX)
                    .attr("y", midY + 20)
                    .attr("dy", ".35em")
                    .attr("text-anchor", "middle")
                    .text(["企業自主碳盤查", "政府補助碳盤查(16+4)", "諮詢輔導", "免費可行性評估"][i]);
            });

            const tbody = d3.select("#details tbody");
            const rows = tbody.selectAll("tr")
                .data(data)
                .enter()
                .append("tr")
                .attr("id", d => d.id)
                .on("click", function(_, d) { highlightRow(d); });

            rows.append("td").html(d => d.id);
            rows.append("td").html(d => d.desc);

            function highlightRow(selectedData) {
                rows.classed("highlight", d => d === selectedData);
            }
        });
    </script>
</body>
</html>
